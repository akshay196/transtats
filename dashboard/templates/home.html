{% extends "base.html" %}

{% block extrascript %}
<!--[if lte IE 8]><script language="javascript" type="text/javascript" src="/static/js/excanvas.js"></script><![endif]-->
<script src="/static/js/jquery.flot.js"></script>
<script src="/static/js/jquery.flot.tooltip.js"></script>
<script src="/static/js/transtats.js"></script>
<style type="text/css">
    .graph-area {
        width:100%;
        min-height:600px;
    }
</style>
<script type="text/javascript">
$(document).ready(function () {
    $("#packageName").change(function(event){

        // get package name
        var packageName=$(this).val();

        $.ajax({
             type:"POST",
             url:"/ajax/graph-data",
             data: {
                // package name
                'package': $(this).val()
             },
             dataType: "json",
             success: function(json_response){

                var pkg_desc = json_response['pkg_desc'];
                var graph_data = json_response['graph_data'];
                var ticks = json_response['ticks'];

                var dataset = []

                for (version in graph_data) {
                    if (graph_data.hasOwnProperty(version)) {
                        dataset.push({
                            label: version,
                            data: graph_data[version]
                        });
                    }
                }

                var options = {
                    series: {
                        lines: {
                            show: true
                        },
                        points: {
                            radius: 3,
                            fill: true,
                            show: true
                        },
                    },
                    xaxis: {
                        axisLabel: "Languages",
                        axisLabelUseCanvas: true,
                        axisLabelFontSizePixels: 12,
                        axisLabelFontFamily: 'Verdana, Arial',
                        axisLabelPadding: 10,
                        ticks: ticks
                    },
                    yaxis: {
                        axisLabel: "Translation",
                        axisLabelUseCanvas: true,
                        axisLabelFontSizePixels: 12,
                        axisLabelFontFamily: 'Verdana, Arial',
                        axisLabelPadding: 3,
                        tickFormatter: function (v, axis) {
                            return v + "%";
                        },
                        tickDecimals: 2,
                    },
                    legend: {
                        noColumns: 0,
                        labelBoxBorderColor: "#000000",
                        position: "ne"
                    },
                    grid: {
                        hoverable: true,
                        borderWidth: 2,
                        backgroundColor: { colors: ["#ffffff", "#EDF5FF"] }
                    },
                    tooltip: {
                        show: true,
                        content: "%s | %y translated",
                    },
                };

                $.plot($("#grapharea"), dataset, options);
                var disclaimer = "<span class='pull-right text-warning'><em>Graph is based on sync\'d data.</em></span>";
                $("#packagedesc").html(pkg_desc);
                $("#graphdisclaimer").html(disclaimer);
             },
        });
        return false; //<---- move it here
   });
});
</script>
{% endblock %}

{% block pagebanner %}
    <div class="page-header">
      <h1>About <small>{{ description }}</small></h1>
    </div>
{% endblock %}

{% block navigation %}
    <a href="{% url 'home' %}" class="btn btn-default"><i class="glyphicon glyphicon-stats"></i></a>
    <div class="btn btn-default disabled">Graphs</div>
{% endblock %}

{% block pagecontent %}
    <ul class="nav nav-tabs">
      <li id="tab-graph-default" role="presentation" class="active">
          <a href="{% url 'home' %}">Package wise for enabled languages</a>
      </li>
      <li id="tab-graph-custom" role="presentation"><a href="#">Based on Graph Rules</a></li>
    </ul>
    <div style="padding:20px">
        <div class="row" style="padding-bottom:20px">
            <div class="col-xs-12">
                {% if packages %}
                <select id="packageName" class="selectpicker" data-live-search="true">
                    <option selected disabled>Select Package</option>
                    {% for package in packages %}
                        <option>{{ package.package_name }}</option>
                    {% endfor %}
                </select>
                {% else %}
                    <br/><p>No package configured. Add <a href="{% url 'settings-packages' %}">one</a> now.</p>
                {% endif %}
                <span class="text-info pull-right" id="packagedesc"></span>
            </div>
        </div>
        <div id="grapharea" class="panel panel-info graph-area"></div>
        <p id="graphdisclaimer"></p>
    </div>
{% endblock %}
