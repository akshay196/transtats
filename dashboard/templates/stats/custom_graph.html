{% extends "home.html" %}

{% block extrascript %}
<!--[if lte IE 8]><script language="javascript" type="text/javascript" src="/static/js/excanvas.js"></script><![endif]-->
<script src="/static/js/jquery.flot.js"></script>
<script src="/static/js/jquery.flot.tooltip.js"></script>
<script src="/static/js/jquery.flot.stack.js"></script>
<script src="/static/js/csrf.js"></script>
<style type="text/css">
    .graph-area {
        width:100%;
        min-height:600px;
    }
</style>
<script type="text/javascript">
function csrfSafeMethod(method){return(/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));}
$(document).ready(function(){$('#tab-translation-coverage').addClass('active');$("#ruleName").change(function(event){var rule=$(this).val();$.ajax({beforeSend:function(xhr,settings){if(!csrfSafeMethod(settings.type)&&!this.crossDomain){if(csrftoken){xhr.setRequestHeader("X-CSRFToken",csrftoken);}else{xhr.setRequestHeader("X-CSRFToken","{{ csrf_token }}");}}},type:"POST",url:"/ajax/graph-data",data:{'graph_rule':$(this).val()},dataType:"json",success:function(json_response){var release_branch=json_response['branch'];var dataset=json_response['graph_data'];var ticks=json_response['ticks'];var options={series:{stack:0,bars:{show:true,barWidth:0.4,align:'center',}},xaxis:{axisLabel:"Packages",axisLabelUseCanvas:true,axisLabelFontSizePixels:12,axisLabelFontFamily:'Verdana, Arial',axisLabelPadding:10,ticks:ticks},yaxis:{axisLabel:"Translation",axisLabelUseCanvas:true,axisLabelFontSizePixels:12,axisLabelFontFamily:'Verdana, Arial',axisLabelPadding:3,tickFormatter:function(v,axis){return v+"%";},tickDecimals:2,},legend:{noColumns:0,labelBoxBorderColor:"#000000",position:"ne"},grid:{hoverable:true,borderWidth:2,backgroundColor:{colors:["#ffffff","#EDF5FF"]}},tooltip:{show:true,content:"%s | %y translated",},};$.plot($("#grapharea"),dataset,options);$("#coverageinfo").html("Translation coverage of "+ticks.length+" packages for "+release_branch+" release in "+dataset.length+" languages.");$("#relbranch").html("Release [ "+release_branch+" ]");var disclaimer="<span class='pull-right text-muted'>Graph is based on branch mapping. And %age is calculated on messages.</span>";$("#graphdisclaimer").html(disclaimer);},});return false;});});
</script>
{% endblock %}

{% block tabcontent %}
    <br/><hr/><span style="padding-left:20px;padding-right:10px;"
                    class="glyphicon glyphicon-info-sign" aria-hidden="true"></span>
        <span id="coverageinfo" class="text-info">
            Translation coverage of a package list for a specific release in selected languages.</span><hr/>
    <div style="padding:20px">
        <div class="row" style="padding-bottom:20px">
            <div class="col-xs-12">
                {% if rules %}
                <select id="ruleName" class="selectpicker" data-live-search="true">
                    <option selected disabled>Select Graph Rule</option>
                    {% for rule in rules %}
                        <option>{{ rule.rule_name }}</option>
                    {% endfor %}
                </select>
                {% else %}
                    <br/><p>No graph-rules configured. Add <a href="{% url 'settings-graph-rules-new' %}">one</a> now.</p>
                {% endif %}
                <span class="text-info pull-right" id="relbranch"></span>
            </div>
        </div>
        <div id="grapharea" class="panel panel-info graph-area"></div>
        <p id="graphdisclaimer"></p>
    </div>
{% endblock %}
