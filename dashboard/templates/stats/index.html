{% extends "home.html" %}

{% block extrascript %}
<!--[if lte IE 8]><script language="javascript" type="text/javascript" src="/static/js/excanvas.js"></script><![endif]-->
<script src="/static/js/jquery.flot.js"></script>
<script src="/static/js/jquery.flot.tooltip.js"></script>
<script src="/static/js/csrf.js"></script>
<style type="text/css">
    .graph-area {
        width:100%;
        min-height:600px;
    }
</style>
<script type="text/javascript">
function csrfSafeMethod(method){return(/^(GET|HEAD|OPTIONS|TRACE)$/.test(method))}
$(document).ready(function(){var disclaimer="<span class='pull-right text-muted'>Graph is based on sync\'d data. And %age is calculated on messages.</span>";$('#tab-translation-status').addClass('active');$("#langName").selectpicker('hide');$("#packageName").change(function(event){var packageName=$(this).val();$.ajax({beforeSend:function(xhr,settings){if(!csrfSafeMethod(settings.type)&&!this.crossDomain){if(csrftoken){xhr.setRequestHeader("X-CSRFToken",csrftoken)}else{xhr.setRequestHeader("X-CSRFToken","{{ csrf_token }}")}}
$("#langName").selectpicker('hide');$("#langName").selectpicker('val','Select Language')},type:"POST",url:"/ajax/graph-data",data:{'package':packageName},dataType:"json",success:function(json_response){var pkg_desc=json_response.pkg_desc;var graph_data=json_response.graph_data;var ticks=json_response.ticks;var dataset=[]
for(version in graph_data){if(graph_data.hasOwnProperty(version)){dataset.push({label:version,data:graph_data[version]})}}
var options={series:{lines:{show:!0},points:{radius:3,fill:!0,show:!0},},xaxis:{axisLabel:"Languages",axisLabelUseCanvas:!0,axisLabelFontSizePixels:12,axisLabelFontFamily:'Verdana, Arial',axisLabelPadding:10,ticks:ticks},yaxis:{axisLabel:"Translation",axisLabelUseCanvas:!0,axisLabelFontSizePixels:12,axisLabelFontFamily:'Verdana, Arial',axisLabelPadding:3,tickFormatter:function(v,axis){return v+"%"},tickDecimals:2,},legend:{show:!0,noColumns:0,labelBoxBorderColor:"Grey",position:"ne",},grid:{hoverable:!0,borderWidth:2,backgroundColor:{colors:["#ffffff","#EDF5FF"]}},tooltip:{show:!0,content:"%s | %y translated",},};$.plot($("#grapharea"),dataset,options);$("#graphinfo").html("Translation status of "+packageName+" for "+dataset.length+" branch(es) in "+ticks.length+" language(s).");$("#packagedesc").html(pkg_desc);$("#graphdisclaimer").html(disclaimer);$("#langName").selectpicker('show')},});return!1});$("#langName").change(function(event){var langID=$(this).val();var packageName=$("#packageName").val();$.ajax({beforeSend:function(xhr,settings){if(!csrfSafeMethod(settings.type)&&!this.crossDomain){if(csrftoken){xhr.setRequestHeader("X-CSRFToken",csrftoken)}else{xhr.setRequestHeader("X-CSRFToken","{{ csrf_token }}")}}},type:"POST",url:"/ajax/graph-data",data:{'package':packageName,'locale':langID},dataType:"json",success:function(json_response){var pkg_desc=json_response.pkg_desc;var graph_data=json_response.graph_data;var ticks=json_response.ticks;var dataSet=[{label:"Translation Progress",data:graph_data}];var options={series:{bars:{show:!0},},bars:{align:"center",barWidth:0.5*ticks.length/10,horizontal:!0,},xaxis:{axisLabel:"Translation Percentage",axisLabelUseCanvas:!0,axisLabelFontSizePixels:12,axisLabelFontFamily:'Verdana, Arial',axisLabelPadding:10,max:110,tickFormatter:function(v,axis){return v+"%"},},yaxis:{axisLabel:"Branches",axisLabelUseCanvas:!0,axisLabelFontSizePixels:12,axisLabelFontFamily:'Verdana, Arial',axisLabelPadding:3,ticks:ticks,},legend:{noColumns:0,labelBoxBorderColor:"#000000",position:"ne"},grid:{hoverable:!0,borderWidth:2,backgroundColor:{colors:["#ffffff","#EDF5FF"]}},tooltip:{show:!0,content:"%y | %x translated",},};$.plot($("#grapharea"),dataSet,options);$("#graphinfo").html("Translation status of "+packageName+" for "+ticks.length+" branch(es) in "+langID+" locale.");$("#packagedesc").html(pkg_desc);$("#graphdisclaimer").html(disclaimer)},});return!1})})</script>
{% endblock %}

{% block tabcontent %}
    <br/><br/>
    <nav class="navbar navbar-default bg-faded">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" id="graphinfo">Translation status of a package for most of the branches in all enabled languages.</a>
            </div>
        </div>
    </nav>
    <div style="padding:20px">
        <div class="row" style="padding-bottom:20px">
            <div class="col-xs-12">
                {% if packages %}
                <select id="packageName" class="selectpicker" data-live-search="true">
                    <option selected disabled>Select Package</option>
                    {% for package_name, upstream_name in packages %}
                        <option>{{ package_name }}</option>
                    {% endfor %}
                </select>
                {% else %}
                    <br/><p>No package configured. Add <a href="{% url 'settings-packages-new' %}">one</a> now.</p>
                {% endif %}
                {% if languages %}
                <select id="langName" class="selectpicker" data-live-search="true">
                    <option selected disabled>Select Language</option>
                    {% for locale, lang in languages %}
                        <option value="{{ locale }}">{{ lang }}</option>
                    {% endfor %}
                </select>
                {% endif %}
                <span class="text-info pull-right" id="packagedesc"></span>
            </div>
        </div>
        <div id="grapharea" class="panel panel-info graph-area"></div>
        <p id="graphdisclaimer"></p>
    </div>
{% endblock %}
