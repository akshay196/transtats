{% extends "settings/settings_base.html" %}
{% load crispy_forms_tags custom_tags %}

{% block extrascript %}
<script src="/static/js/csrf.js"></script>
<script src="/static/js/jquery-1.12.3.js"></script>
<script type="text/javascript">
    function csrfSafeMethod(a){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(a)}$(document).ready(function(){$("#tab-packages").addClass("active"),$("#refreshPackageLink").click(function(a){return a.preventDefault(),$.ajax({beforeSend:function(a,b){csrfSafeMethod(b.type)||this.crossDomain||(csrftoken?a.setRequestHeader("X-CSRFToken",csrftoken):a.setRequestHeader("X-CSRFToken","{{ csrf_token }}")),$("#refreshProgress").html("<img src='/static/img/spin.gif'></img>"),$("#refreshPackageLink").attr("disabled",!0)},type:"POST",url:"{% url 'ajax-refresh-package' %}",data:{package:"{{ package_name }}",task:$("#syncPackageIdentifier").val()},success:function(a){$("#refreshPackageLink").attr("disabled",!1),$("#refreshProgress").html("<span class='glyphicon glyphicon-ok' style='color:green'></span>"),setTimeout(function(){$("#span-notify-sync").html("Package Sync Complete!")},1e3)},error:function(a,b,c){$("#refreshPackageLink").attr("disabled",!1),$("#refreshProgress").html("<span class='glyphicon glyphicon-warning-sign' style='color:orange'></span>")}}),!1}),$("#createBranchMapping").click(function(a){return a.preventDefault(),$.ajax({beforeSend:function(a,b){csrfSafeMethod(b.type)||this.crossDomain||(csrftoken?a.setRequestHeader("X-CSRFToken",csrftoken):a.setRequestHeader("X-CSRFToken","{{ csrf_token }}")),$("#createBranchMapping").attr("disabled",!0)},type:"POST",url:"{% url 'ajax-refresh-package' %}",data:{package:"{{ package_name }}",task:$("#mapBranchesIdentifier").val()},success:function(a){$("#createBranchMapping").attr("disabled",!1),setTimeout(function(){$("#div-branch-mapping").html(a)},1e3)},error:function(a,b,c){$("#createBranchMapping").attr("disabled",!1)}}),!1})});
</script>
{% endblock %}

{% block navigation %}
    <a href="{% url 'home' %}" class="btn btn-default"><i class="glyphicon glyphicon-home"></i></a>
    <a href="{% url 'settings' %}" class="btn btn-default">Settings</a>
    <a href="{% url 'settings-packages' %}" class="btn btn-default">Package</a>
    <a href="{% url 'settings-package-config' package_name %}" class="btn btn-default">Config</a>
{% endblock %}

{% block tabcontent %}
    <div class="row">
        <div class="col-xs-12">
            <span>
                <span class="glyphicon glyphicon-random" aria-hidden="true"></span>
                &nbsp;&nbsp;<span class="text-muted" style="font-size:large"><b>{{ package_name }}</b> | Configuration</span>
            </span>
            <span class="pull-right">
                <span class="btn-group" role="group" aria-label="...">
                  <a id="refreshPackageLink" type="button" class="btn btn-default btn-small">
                    <input type="hidden" value="syncPkg" id="syncPackageIdentifier"/>
                    <span id="refreshProgress"><span class="glyphicon glyphicon-refresh" aria-hidden="true"></span></span> Sync Package
                  </a>
                  {% if last_sync %}
                      <a id="createBranchMapping" type="button" class="btn btn-default btn-small">
                        <input type="hidden" value="mapBranches" id="mapBranchesIdentifier"/> Map Branches
                      </a>
                  {% endif %}
                </span>
                <a type="button" class="btn btn-default" href="{% url 'settings-packages' %}">Back to List Packages</a>
            </span>
        </div>
    </div>
    <hr/>
    {% if package_details  %}
        <span class="text-info"><b>Description:</b> {{ package_details }}</span>
        <span id="span-notify-sync" class="pull-right text-success"></span><hr/>
    {% endif %}
    <div id="div-branch-mapping">
        {% tag_branch_mapping package_name %}
    </div>
{% endblock %}
